{{define "settings"}}
<!DOCTYPE html>
<html data-bs-theme="light">
{{template "head.tmpl" .}}

<body class="bg-light">
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg glassmorphism position-fixed w-100 top-0" style="z-index: 1030; backdrop-filter: blur(10px);">
    <div class="container-fluid px-4">
      <div class="d-flex align-items-center w-100">
        <a href="/" class="modern-btn modern-btn-secondary me-3" title="Back to Chat">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"/>
          </svg>
        </a>

        <a class="navbar-brand fw-bold d-flex align-items-center" href="/" style="color: var(--primary-color);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
            <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
          </svg>
          Settings
        </a>

        <div class="d-flex align-items-center gap-3 ms-auto">
          <button id="darkModeToggle" class="modern-btn modern-btn-secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
            </svg>
            <span>Dark</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container-fluid" style="margin-top: 80px; padding: 2rem;">
    <div class="row justify-content-center">
      <div class="col-lg-10 col-xl-8">

        <!-- API Keys Section -->
        <div class="modern-card p-4 mb-4">
          <h4 class="mb-4" style="color: var(--text-primary);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M7,14A2,2 0 0,1 5,12A2,2 0 0,1 7,10A2,2 0 0,1 9,12A2,2 0 0,1 7,14M12.65,10C11.83,7.67 9.61,6 7,6A6,6 0 0,0 1,12A6,6 0 0,0 7,18C9.61,18 11.83,16.33 12.65,14H17V18H21V14H23V10H12.65Z"/>
            </svg>
            API Keys
          </h4>

          <!-- OpenAI API Key -->
          <div class="mb-4">
            <label class="form-label fw-semibold" style="color: var(--text-primary);">
              OpenAI API Key
            </label>
            <div class="input-group">
              <input type="password"
                     id="openaiApiKeyInput"
                     class="form-control"
                     placeholder="sk-proj-..."
                     style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);">
              <button class="btn btn-outline-secondary"
                      type="button"
                      id="toggleOpenaiKey"
                      style="border-color: var(--border-color); color: var(--text-secondary);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                </svg>
              </button>
              <button class="btn btn-primary"
                      type="button"
                      id="saveOpenaiKey"
                      style="background: var(--accent-color); border-color: var(--accent-color);">
                Save
              </button>
            </div>
            <div class="form-text" style="color: var(--text-secondary);">
              Used for GPT models. Your API key starts with "sk-proj-" or "sk-".
            </div>
          </div>

          <!-- Anthropic API Key -->
          <div class="mb-4">
            <label class="form-label fw-semibold" style="color: var(--text-primary);">
              Anthropic API Key
            </label>
            <div class="input-group">
              <input type="password"
                     id="anthropicApiKeyInput"
                     class="form-control"
                     placeholder="sk-ant-..."
                     style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);">
              <button class="btn btn-outline-secondary"
                      type="button"
                      id="toggleAnthropicKey"
                      style="border-color: var(--border-color); color: var(--text-secondary);">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                </svg>
              </button>
              <button class="btn btn-primary"
                      type="button"
                      id="saveAnthropicKey"
                      style="background: var(--accent-color); border-color: var(--accent-color);">
                Save
              </button>
            </div>
            <div class="form-text" style="color: var(--text-secondary);">
              Used for Claude models. Your API key starts with "sk-ant-".
            </div>
          </div>
        </div>

        <!-- MCP Servers Section -->
        <div class="modern-card p-4 mb-4">
          <h4 class="mb-4" style="color: var(--text-primary);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z"/>
            </svg>
            MCP Servers
            <small class="text-muted ms-2">(Model Context Protocol)</small>
          </h4>

          <div class="mb-3">
            <p style="color: var(--text-secondary); font-size: 0.9rem;">
              MCP servers provide external tools and data sources. Enable servers to make their tools available to your agents.
            </p>
          </div>

          <!-- Server List -->
          <div id="mcpServersList" class="mb-3">
            <div class="text-center py-4" style="color: var(--text-secondary);">
              <div class="spinner-border spinner-border-sm me-2" role="status"></div>
              Loading MCP servers...
            </div>
          </div>

          <!-- Add Server Button -->
          <div class="d-grid">
            <button id="addMcpServerBtn" class="modern-btn modern-btn-primary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
                <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
              </svg>
              Add MCP Server
            </button>
          </div>
        </div>

        <!-- System Information -->
        <div class="modern-card p-4 mb-4">
          <h4 class="mb-4" style="color: var(--text-primary);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z"/>
            </svg>
            System Information
          </h4>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="p-3" style="background: var(--bg-secondary); border-radius: var(--radius-md);">
                <div class="d-flex justify-content-between align-items-center">
                  <span style="color: var(--text-secondary);">Version</span>
                  <span class="badge" style="background: var(--accent-color);">{{.Version}}</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="p-3" style="background: var(--bg-secondary); border-radius: var(--radius-md);">
                <div class="d-flex justify-content-between align-items-center">
                  <span style="color: var(--text-secondary);">Status</span>
                  <span class="badge badge-success">Online</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="p-3" style="background: var(--bg-secondary); border-radius: var(--radius-md);">
                <div class="d-flex justify-content-between align-items-center">
                  <span style="color: var(--text-secondary);">Current Agent</span>
                  <span style="color: var(--text-primary); font-weight: 500;">{{.CurrentAgent}}</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="p-3" style="background: var(--bg-secondary); border-radius: var(--radius-md);">
                <div class="d-flex justify-content-between align-items-center">
                  <span style="color: var(--text-secondary);">Model</span>
                  <span style="color: var(--text-primary); font-weight: 500;">{{.Model}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="modern-card p-4 mb-4">
          <h4 class="mb-4" style="color: var(--text-primary);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z"/>
            </svg>
            Actions
          </h4>

          <div class="d-grid gap-2">
            <button id="systemDiagnosticsBtn" class="modern-btn modern-btn-secondary text-start">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
                <path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z"/>
              </svg>
              Run System Diagnostics
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- MCP Modals -->
  <!-- Add MCP Server Modal -->
  <div class="modal fade" id="addMcpServerModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add MCP Server</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="addMcpServerForm">
            <div class="mb-3">
              <label class="form-label">Server Name</label>
              <input type="text" class="form-control" id="mcpServerName" required placeholder="e.g., filesystem">
            </div>
            <div class="mb-3">
              <label class="form-label">Command</label>
              <input type="text" class="form-control" id="mcpServerCommand" required placeholder="e.g., npx">
            </div>
            <div class="mb-3">
              <label class="form-label">Arguments (one per line)</label>
              <textarea class="form-control" id="mcpServerArgs" rows="3" placeholder="-y&#10;@modelcontextprotocol/server-filesystem"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Environment Variables (optional)</label>
              <textarea class="form-control" id="mcpServerEnv" rows="2" placeholder="KEY=value"></textarea>
              <small class="form-text text-muted">One per line, format: KEY=value</small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveMcpServerBtn">Add Server</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MCP Server Details Modal -->
  <div class="modal fade" id="mcpServerDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="mcpServerDetailsTitle">Server Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="mcpServerDetailsBody">
          <div class="text-center py-4">
            <div class="spinner-border" role="status"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/modules/settings-page.js"></script>
  <script src="js/modules/mcp.js"></script>
</body>
</html>
{{end}}
