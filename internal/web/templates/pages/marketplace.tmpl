{{define "marketplace"}}
<!DOCTYPE html>
<html lang="en">
{{template "head.tmpl" .}}

<style>
/* Make placeholder text lighter in dark mode */
#searchPlugins::placeholder {
    color: var(--text-secondary);
    opacity: 0.7;
}

.dark-mode #searchPlugins::placeholder {
    color: var(--text-secondary);
    opacity: 0.9;
}

#pluginGrid.list-view .plugin-card {
    transition: background 0.2s, box-shadow 0.2s;
}

.list-view-card .card-body {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
}

.list-view-card .plugin-info {
    flex: 1 1 auto;
}

.list-view-card .plugin-actions {
    min-width: 160px;
    text-align: right;
}

.list-view-card .plugin-metadata {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
}
</style>

<body>
    {{template "navbar.tmpl" .}}

    <!-- Platform information for JavaScript -->
    <input type="hidden" id="currentPlatform" value="{{if .Extra}}{{index .Extra "CurrentPlatform"}}{{end}}">
    <input type="hidden" id="currentPlatformDisplay" value="{{if .Extra}}{{index .Extra "CurrentPlatformDisplay"}}{{end}}">

    <div class="main-content-wrapper">
        {{template "sidebar.tmpl" .}}

        <div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <main class="col-12 px-md-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <div class="d-flex align-items-center">
                <h1 class="h2 mb-0">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
                        <path d="M18,13H20V17H22V19H16V13H18M18,5H22V11H18M8,13H14V19H8M8,1H14V11H8V1Z"/>
                    </svg>
                    Plugin Marketplace
                </h1>
            </div>
            <div class="btn-toolbar mb-2 mb-md-0 gap-2">
                <div class="btn-group" role="group" aria-label="View mode toggle">
                    <button type="button" class="btn btn-sm btn-outline-secondary active" id="gridViewBtn" title="Grid view">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4,4H10V10H4V4M14,4H20V10H14V4M14,14H20V20H14V14M4,14H10V20H4V14Z"/>
                        </svg>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="listViewBtn" title="List view">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3,5H21V7H3V5M3,10H21V12H3V10M3,15H21V17H3V15M3,20H21V22H3V20Z"/>
                        </svg>
                    </button>
                </div>
                <button type="button" class="btn btn-sm btn-outline-secondary" id="refreshMarketplaceBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                    </svg>
                            Refresh
                        </button>
                    </div>
                </div>

                <!-- Search and Filter Bar -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                                </svg>
                            </span>
                            <input type="text" class="form-control" id="searchPlugins" placeholder="Search plugins..." style="color: var(--text-primary);">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="filterOptions" id="filterAll" checked>
                            <label class="btn btn-outline-primary" for="filterAll">All</label>

                            <input type="radio" class="btn-check" name="filterOptions" id="filterInstalled">
                            <label class="btn btn-outline-primary" for="filterInstalled">Installed</label>

                            <input type="radio" class="btn-check" name="filterOptions" id="filterAvailable">
                            <label class="btn btn-outline-primary" for="filterAvailable">Available</label>

                            <input type="radio" class="btn-check" name="filterOptions" id="filterUpdates">
                            <label class="btn btn-outline-primary" for="filterUpdates">Updates</label>
                        </div>
                    </div>
                </div>

                <!-- Platform Compatibility Info and Filter -->
                {{if .Extra}}
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="text-muted small" style="color: var(--text-secondary) !important;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="me-1">
                                    <path d="M17,19H7V5H17M17,1H7C5.89,1 5,1.89 5,3V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V3C19,1.89 18.1,1 17,1Z"/>
                                </svg>
                                Showing plugins for: <strong>{{index .Extra "CurrentPlatformDisplay"}}</strong>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="showIncompatibleToggle">
                                <label class="form-check-label small" for="showIncompatibleToggle">
                                    Show incompatible plugins
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                {{end}}

                <!-- Plugin Grid -->
                <div class="row" id="pluginGrid">
                    <div class="col-12 text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 text-muted">Loading plugins...</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Plugin Details Modal -->
    <div class="modal fade" id="pluginDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pluginDetailsTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="pluginDetailsBody">
                    <!-- Plugin details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="installPluginBtn" style="display: none;">Install</button>
                    <button type="button" class="btn btn-success" id="updatePluginBtn" style="display: none;">Update</button>
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/modules/agents.js"></script>
    <script src="js/modules/plugins.js"></script>
    <script src="js/modules/sidebar.js"></script>
    <script src="js/modules/themeManager.js"></script>
    <script>
        // Initialize theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            themeManager.initialize();
        });
    </script>
    <script src="js/modules/marketplace.js"></script>
</body>
</html>
{{end}}
