<!-- Modal placeholders - will be filled with actual modal content later -->
<div class="modal fade" id="agentInfoModal" tabindex="-1" aria-labelledby="agentInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="agentInfoModalLabel">Agent Information</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Modal content will be populated here -->
        <p>Agent information will be displayed here...</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Update Available Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="updateModalLabel">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
            <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
          </svg>
          Update Available
        </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="updateModalBody">
        <div class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Later</button>
        <a id="downloadUpdateBtn" href="#" class="btn btn-primary" target="_blank" style="display:none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-1">
            <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
          </svg>
          Download Update
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Onboarding Modal -->
<style>
  /* Onboarding Modal Animations */
  #onboardingModal .modal-dialog {
    animation: modalSlideIn 0.4s ease-out;
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-50px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Step transition animations */
  .onboarding-step {
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
  }

  .onboarding-step.d-none {
    opacity: 0;
    transform: translateX(-20px);
  }

  .onboarding-step:not(.d-none) {
    opacity: 1;
    transform: translateX(0);
  }

  /* Progress bar animation */
  #onboardingProgress {
    transition: width 0.5s ease-in-out;
  }

  /* Button hover effects */
  #onboardingModal .modal-footer button {
    transition: all 0.2s ease-in-out;
  }

  #onboardingModal .modal-footer button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  #onboardingModal .modal-footer button:active {
    transform: translateY(0);
  }

  /* Fade in animation for modal backdrop */
  #onboardingModal.show .modal-backdrop {
    animation: fadeIn 0.3s ease-in;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 0.5; }
  }
</style>

<div class="modal fade" id="onboardingModal" tabindex="-1" aria-labelledby="onboardingModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog" aria-modal="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="onboardingModalLabel">Welcome to Dolphin Agent</h1>
        <button type="button" class="btn-close" id="onboardingCloseBtn" aria-label="Close" onclick="fetch('/api/onboarding/skip', {method: 'POST'}).then(() => location.reload())" style="pointer-events: auto !important; cursor: pointer !important; z-index: 10001;"></button>
      </div>
      <div class="modal-body">
        <!-- Progress indicator -->
        <div class="mb-4">
          <div class="d-flex justify-content-between mb-2">
            <span class="text-muted small">Step <span id="currentStepNum">1</span> of <span id="totalStepsNum">5</span></span>
          </div>
          <div class="progress" style="height: 4px;">
            <div id="onboardingProgress" class="progress-bar" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>

        <!-- Step 0: Device Detection -->
        <div class="onboarding-step" id="step-0" role="tabpanel" aria-labelledby="step-0-title">
          <h3 class="mb-3" id="step-0-title">Device Detection</h3>
          <p class="mb-4">We've detected information about your device to optimize your experience.</p>

          <div class="card mb-3" id="deviceInfoCard">
            <div class="card-body">
              <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Detecting device...</span>
                </div>
                <p class="mt-2 mb-0 text-muted">Detecting your device...</p>
              </div>
            </div>
          </div>

          <div id="deviceInfoContent" class="d-none">
            <div class="card mb-3">
              <div class="card-body">
                <h5 class="card-title mb-3">Detected Information:</h5>
                <div class="row">
                  <div class="col-md-4 mb-2">
                    <small class="text-muted d-block">Device Type</small>
                    <strong id="detectedType" class="text-capitalize">-</strong>
                  </div>
                  <div class="col-md-4 mb-2">
                    <small class="text-muted d-block">Operating System</small>
                    <strong id="detectedOS" class="text-capitalize">-</strong>
                  </div>
                  <div class="col-md-4 mb-2">
                    <small class="text-muted d-block">Architecture</small>
                    <strong id="detectedArch">-</strong>
                  </div>
                </div>
              </div>
            </div>

            <div class="alert alert-info mb-3">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
                <path d="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
              </svg>
              If the detected device type is incorrect, you can change it below:
            </div>

            <div class="mb-3">
              <label for="deviceTypeSelect" class="form-label">Device Type:</label>
              <select class="form-select" id="deviceTypeSelect" aria-label="Select device type">
                <option value="desktop">Desktop</option>
                <option value="laptop">Laptop</option>
                <option value="server">Server</option>
                <option value="unknown">Unknown</option>
              </select>
              <div class="form-text">This helps us optimize the interface and features for your setup.</div>
            </div>
          </div>
        </div>

        <!-- Step 1: API Keys Configuration -->
        <div class="onboarding-step d-none" id="step-1" role="tabpanel" aria-labelledby="step-1-title">
          <h3 class="mb-3" id="step-1-title">Configure API Keys</h3>
          <p class="mb-4">To use AI models, you'll need to configure at least one API key. You can add multiple providers.</p>

          <!-- Placeholder for environment variable info (populated by JavaScript) -->
          <div id="apiKeysEnvInfo" class="d-none"></div>

          <div class="alert alert-info mb-3">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
            </svg>
            You can skip this step and add API keys later in Settings.
          </div>

          <div class="mb-3">
            <label for="openaiApiKey" class="form-label">
              OpenAI API Key
              <span class="text-muted small">(for GPT models)</span>
            </label>
            <div class="input-group">
              <input type="password" class="form-control" id="openaiApiKey" placeholder="sk-..." aria-label="OpenAI API Key">
              <button class="btn btn-outline-secondary" type="button" id="toggleOpenaiKey" aria-label="Toggle OpenAI API key visibility">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                </svg>
              </button>
            </div>
            <div class="form-text">Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a></div>
          </div>

          <div class="mb-3">
            <label for="anthropicApiKey" class="form-label">
              Anthropic API Key
              <span class="text-muted small">(for Claude models)</span>
            </label>
            <div class="input-group">
              <input type="password" class="form-control" id="anthropicApiKey" placeholder="sk-ant-..." aria-label="Anthropic API Key">
              <button class="btn btn-outline-secondary" type="button" id="toggleAnthropicKey" aria-label="Toggle Anthropic API key visibility">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                </svg>
              </button>
            </div>
            <div class="form-text">Get your API key from <a href="https://console.anthropic.com/settings/keys" target="_blank">Anthropic Console</a></div>
          </div>

          <div class="alert alert-success d-none" id="apiKeysSuccess">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M16.59,7.58L10,14.17L7.41,11.59L6,13L10,17L18,9L16.59,7.58Z"/>
            </svg>
            API keys saved successfully!
          </div>

          <div class="alert alert-danger d-none" id="apiKeysError">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"/>
            </svg>
            <span id="apiKeysErrorMessage">Failed to save API keys. Please try again.</span>
          </div>
        </div>

        <!-- Step 2: Welcome -->
        <div class="onboarding-step d-none" id="step-2" role="tabpanel" aria-labelledby="step-2-title">
          <h3 class="mb-3" id="step-2-title">Get Started with Dolphin Agent</h3>
          <p class="lead mb-4">Your AI-powered assistant with customizable plugins and tools.</p>
          <div class="alert alert-info mb-3">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
            </svg>
            This quick tour will help you understand the key features and get you up and running.
          </div>
          <ul class="list-unstyled mb-0">
            <li class="mb-2">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-success me-2">
                <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
              </svg>
              Create and manage AI agents
            </li>
            <li class="mb-2">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-success me-2">
                <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
              </svg>
              Install plugins to extend capabilities
            </li>
            <li class="mb-2">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-success me-2">
                <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
              </svg>
              Configure API keys and settings
            </li>
          </ul>
        </div>

        <!-- Step 3: Create Agent -->
        <div class="onboarding-step d-none" id="step-3" role="tabpanel" aria-labelledby="step-3-title">
          <h3 class="mb-3" id="step-3-title">Create Your First Agent</h3>
          <p class="mb-4">Agents are AI assistants that can use plugins and tools to help you accomplish tasks.</p>
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">How to create an agent:</h5>
              <ol class="mb-0">
                <li class="mb-2">Click the <strong>New Agent</strong> button in the sidebar</li>
                <li class="mb-2">Give your agent a name (e.g., "My Assistant")</li>
                <li class="mb-2">Select an AI model (GPT-4, Claude, etc.)</li>
                <li class="mb-2">Add a custom system prompt if desired</li>
              </ol>
            </div>
          </div>
          <div class="alert alert-warning">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"/>
            </svg>
            You'll need to configure your API keys in settings before creating an agent.
          </div>
        </div>

        <!-- Step 4: Plugins -->
        <div class="onboarding-step d-none" id="step-4" role="tabpanel" aria-labelledby="step-4-title">
          <h3 class="mb-3" id="step-4-title">Extend with Plugins</h3>
          <p class="mb-4">Plugins give your agents special abilities like web search, file operations, and more.</p>
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Installing plugins:</h5>
              <ol class="mb-0">
                <li class="mb-2">Navigate to <strong>Settings â†’ Plugins</strong></li>
                <li class="mb-2">Browse the plugin registry</li>
                <li class="mb-2">Click <strong>Install</strong> on any plugin you want</li>
                <li class="mb-2">Enable plugins for specific agents in their settings</li>
              </ol>
            </div>
          </div>
          <div class="alert alert-success">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M16.59,7.58L10,14.17L7.41,11.59L6,13L10,17L18,9L16.59,7.58Z"/>
            </svg>
            You're all set! Start chatting with your agents and exploring the features.
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" id="skipOnboardingBtn" onclick="fetch('/api/onboarding/skip', {method: 'POST'}).then(() => location.reload())" style="pointer-events: auto !important; cursor: pointer !important; position: relative; z-index: 10000;">Skip Tour</button>
        <div class="ms-auto">
          <button type="button" class="btn btn-secondary d-none" id="prevStepBtn">Previous</button>
          <button type="button" class="btn btn-primary" id="nextStepBtn" style="pointer-events: auto !important;">Next</button>
          <button type="button" class="btn btn-primary d-none" id="completeOnboardingBtn">Get Started</button>
        </div>
      </div>
    </div>
  </div>
</div>