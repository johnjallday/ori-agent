<!DOCTYPE html>
<html data-bs-theme="light">
{{template "head.tmpl" .}}

<body class="bg-light">
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg glassmorphism position-fixed w-100 top-0" style="z-index: 1030; backdrop-filter: blur(10px);">
    <div class="container-fluid px-4">
      <div class="d-flex align-items-center w-100">
        <button id="sidebarToggle" class="modern-btn modern-btn-secondary d-lg-none me-3" title="Toggle Sidebar">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </button>

        <a class="navbar-brand fw-bold d-flex align-items-center" href="#" style="color: var(--primary-color);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          {{.Title}}
        </a>

        <div class="d-flex align-items-center gap-3 ms-auto">
          <span id="currentAgentDisplay" class="modern-badge badge-secondary d-flex align-items-center gap-2" style="cursor:pointer; padding: 0.5rem 1rem; border-radius: var(--radius-lg);" title="Click to view agent details">
            <span class="status-indicator status-online"></span>
            <span class="fw-medium">{{.CurrentAgent}}</span>
          </span>
          <button id="updateNotificationBtn" class="modern-btn modern-btn-primary position-relative" style="display: none; align-items: center; gap: 0.5rem;" onclick="showUpdateModal()" title="Update available">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
            </svg>
            <span>Update</span>
            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle">
              <span class="visually-hidden">New update</span>
            </span>
          </button>
          <button id="darkModeToggle" class="modern-btn modern-btn-secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 3c-4.97 0-9 4.03-9 9s4.03-9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
            </svg>
            <span>Dark</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div class="main-content-wrapper">
    {{template "sidebar.tmpl" .}}

    <!-- Main Content -->
    <div class="main-content">
      {{template "chat-area.tmpl" .}}
    </div>
  </div>

  <!-- Add Agent Modal -->
  <div class="modal fade" id="addAgentModal" tabindex="-1" aria-labelledby="addAgentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="background: var(--bg-primary); border: 1px solid var(--border-color);">
        <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
          <h5 class="modal-title" id="addAgentModalLabel" style="color: var(--text-primary);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.17L11.83 9.51C11.25 9.19 10.61 9 10 9C8.61 9 7.22 9.39 6 10.17L3 7.17L1.59 8.59L4.17 11.17C3.39 12.39 3 13.78 3 15.17C3 16.56 3.39 17.94 4.17 19.17L1.59 21.75L3 23.16L6 20.16C7.22 20.94 8.61 21.33 10 21.33C10.61 21.33 11.25 21.13 11.83 20.82L16.17 16.48L13.5 19.15L15 20.65L21 14.65V12.65L17.83 15.82L12.41 10.41C12.61 10.25 12.8 10.08 13 9.83L17.83 5L21 8.17V9Z"/>
            </svg>
            Create New Agent
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
        </div>
        <div class="modal-body">
          <form id="addAgentForm">
            <div class="mb-3">
              <label for="agentName" class="form-label" style="color: var(--text-primary);">Agent Name</label>
              <input type="text" id="agentName" class="modern-input w-100" placeholder="Enter agent name..." required>
            </div>
            <div class="mb-3">
              <label for="agentType" class="form-label" style="color: var(--text-primary);">Agent Type</label>
              <select id="agentType" class="modern-input w-100">
                <option value="tool-calling">Tool Calling (Cheapest - Optimized for tool use)</option>
                <option value="general">General Purpose (Mid-tier - Balanced capability)</option>
                <option value="research">Research (Expensive - Complex thinking)</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="agentModel" class="form-label" style="color: var(--text-primary);">Model</label>
              <select id="agentModel" class="modern-input w-100">
                <!-- Tool Calling Models -->
                <option value="gpt-5-nano" data-type="tool-calling">GPT-5 Nano</option>
                <option value="gpt-4.1-nano" data-type="tool-calling">GPT-4.1 Nano</option>
                <option value="claude-3-haiku-20240307" data-type="tool-calling">Claude 3 Haiku</option>
                <!-- General Purpose Models -->
                <option value="gpt-5-mini" data-type="general">GPT-5 Mini</option>
                <option value="gpt-4.1-mini" data-type="general">GPT-4.1 Mini</option>
                <option value="gpt-4o-mini" data-type="general">GPT-4o Mini</option>
                <option value="claude-3-sonnet-20240229" data-type="general">Claude 3 Sonnet</option>
                <!-- Research Models -->
                <option value="gpt-5" data-type="research">GPT-5</option>
                <option value="gpt-4.1" data-type="research">GPT-4.1</option>
                <option value="claude-sonnet-4-5" data-type="research">Claude Sonnet 4.5</option>
                <option value="claude-sonnet-4" data-type="research">Claude Sonnet 4</option>
                <option value="claude-opus-4-1" data-type="research">Claude Opus 4.1</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="agentTemperature" class="form-label" style="color: var(--text-primary);">
                Temperature: <span id="temperatureValue">1.0</span>
              </label>
              <input type="range" id="agentTemperature" class="form-range" min="0" max="2" step="0.1" value="1.0"
                     style="cursor: pointer;">
              <div class="d-flex justify-content-between" style="font-size: 0.75rem; color: var(--text-muted);">
                <span>Focused (0)</span>
                <span>Balanced (1)</span>
                <span>Creative (2)</span>
              </div>
            </div>
            <div class="mb-3">
              <label for="agentSystemPrompt" class="form-label" style="color: var(--text-primary);">System Prompt</label>
              <textarea id="agentSystemPrompt" class="form-control" rows="4"
                        style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary); font-size: 0.9em; resize: vertical;"
                        placeholder="You are a helpful assistant with access to various tools. When a user request can be fulfilled by using an available tool, use the tool instead of providing general information. Be concise and direct in your responses."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
          <button type="button" class="modern-btn modern-btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="createAgentBtn" class="modern-btn modern-btn-primary">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="me-1">
              <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
            </svg>
            Create Agent
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Plugin Store Modal -->
  <div class="modal fade" id="pluginStoreModal" tabindex="-1" aria-labelledby="pluginStoreModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="background: var(--bg-primary); border: 1px solid var(--border-color);">
        <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
          <h5 class="modal-title" id="pluginStoreModalLabel" style="color: var(--text-primary);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M20.5,11H19V7C19,5.89 18.1,5 17,5H13V3.5A2.5,2.5 0 0,0 10.5,1A2.5,2.5 0 0,0 8,3.5V5H4C2.89,5 2,5.89 2,7V10.8H3.5C5,10.8 6.2,12 6.2,13.5C6.2,15 5,16.2 3.5,16.2H2V20C2,21.11 2.89,22 4,22H7.8V20.5C7.8,19 9,17.8 10.5,17.8C12,17.8 13.2,19 13.2,20.5V22H17C18.11,22 19,21.11 19,20V16H20.5A2.5,2.5 0 0,0 23,13.5A2.5,2.5 0 0,0 20.5,11Z"/>
            </svg>
            Plugin Store
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <p style="color: var(--text-secondary);">Browse and install plugins from the online repository.</p>
          </div>
          <div id="onlinePluginsList" class="online-plugins-list">
            <!-- Online plugins will be loaded dynamically -->
          </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
          <button type="button" class="modern-btn modern-btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Plugin Upload Modal -->
  <div class="modal fade" id="pluginUploadModal" tabindex="-1" aria-labelledby="pluginUploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="background: var(--bg-primary); border: 1px solid var(--border-color);">
        <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
          <h5 class="modal-title" id="pluginUploadModalLabel" style="color: var(--text-primary);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
            Upload Plugin
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <p style="color: var(--text-secondary);">Upload a plugin file (.so) by dragging and dropping it below or clicking to browse.</p>
          </div>
          
          <!-- Drag and Drop Area -->
          <div id="uploadDropZone" class="upload-drop-zone mb-3" style="border: 2px dashed var(--border-color); border-radius: 8px; background: var(--bg-secondary); cursor: pointer; transition: all 0.3s ease;">
            <div class="text-center py-5">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" class="mb-3" style="color: var(--text-secondary);">
                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
              </svg>
              <h6 style="color: var(--text-primary);">Drag & Drop Plugin File</h6>
              <p class="text-muted mb-3">Or click to browse for files</p>
              <button type="button" class="modern-btn modern-btn-secondary" onclick="event.stopPropagation(); document.getElementById('pluginFileInput').click()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="me-1">
                  <path d="M16,13H15V18H13V13H8L12,9L16,13M15,4H9V6H15V4Z"/>
                </svg>
                Browse Files
              </button>
            </div>
          </div>
          
          <!-- Hidden File Input -->
          <input type="file" id="pluginFileInput" accept=".so" style="display: none;">
          
          <!-- Upload Progress -->
          <div id="uploadProgress" class="d-none mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span style="color: var(--text-primary);">Uploading...</span>
              <span id="uploadPercent" style="color: var(--text-secondary);">0%</span>
            </div>
            <div class="progress">
              <div id="uploadProgressBar" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
          
          <!-- Upload Result -->
          <div id="uploadResult" class="d-none"></div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
          <button type="button" class="modern-btn modern-btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Update Available Modal -->
  <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="background: var(--bg-primary); border: 1px solid var(--border-color);">
        <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
          <h5 class="modal-title" id="updateModalLabel" style="color: var(--text-primary);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
            </svg>
            Update Available
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
        </div>
        <div class="modal-body" id="updateModalBody">
          <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
          <button type="button" class="modern-btn modern-btn-secondary" data-bs-dismiss="modal">Later</button>
          <a id="downloadUpdateBtn" href="#" class="modern-btn modern-btn-primary" target="_blank" style="display:none;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="me-1">
              <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
            </svg>
            Download Update
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Plugin Updates Modal -->
  <div class="modal fade" id="pluginUpdatesModal" tabindex="-1" aria-labelledby="pluginUpdatesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="background: var(--bg-primary); border: 1px solid var(--border-color);">
        <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
          <h5 class="modal-title" id="pluginUpdatesModalLabel" style="color: var(--text-primary);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="me-2">
              <path d="M20.5,11H19V7C19,5.89 18.1,5 17,5H13V3.5A2.5,2.5 0 0,0 10.5,1A2.5,2.5 0 0,0 8,3.5V5H4C2.89,5 2,5.89 2,7V10.8H3.5C5,10.8 6.2,12 6.2,13.5C6.2,15 5,16.2 3.5,16.2H2V20C2,21.11 2.89,22 4,22H7.8V20.5C7.8,19 9,17.8 10.5,17.8C12,17.8 13.2,19 13.2,20.5V22H17C18.11,22 19,21.11 19,20V16H20.5A2.5,2.5 0 0,0 23,13.5A2.5,2.5 0 0,0 20.5,11Z"/>
            </svg>
            Plugin Updates
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
        </div>
        <div class="modal-body" id="pluginUpdatesModalBody">
          <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid var(--border-color);">
          <button type="button" class="modern-btn modern-btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Sidebar modules - loaded before main app -->
  <script src="js/modules/resizer.js"></script>
  <script src="js/modules/settings.js"></script>
  <script src="js/modules/agents.js"></script>
  <script src="js/modules/plugins.js"></script>
  <script src="js/modules/plugin-config.js"></script>
  <script src="js/modules/plugin-store.js"></script>
  <script src="js/modules/apikey.js"></script>
  <script src="js/modules/sidebar.js"></script>
  <script src="js/modules/update-checker.js"></script>
  <script src="js/modules/plugin-update-checker.js"></script>
  <script src="js/modules/file-upload.js"></script>
  <script src="js/app.js?v=1694538177"></script>
</body>
</html>